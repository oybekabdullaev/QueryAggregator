DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'QueryAggregator.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '202012101209524_InitialModel'
BEGIN
    CREATE TABLE [dbo].[Queries] (
        [Id] [int] NOT NULL IDENTITY,
        [QueryString] [nvarchar](255) NOT NULL,
        CONSTRAINT [PK_dbo.Queries] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Links] (
        [Id] [int] NOT NULL IDENTITY,
        [Url] [nvarchar](max) NOT NULL,
        [Title] [nvarchar](max) NOT NULL,
        [Description] [nvarchar](max),
        [Query_Id] [int],
        CONSTRAINT [PK_dbo.Links] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_Query_Id] ON [dbo].[Links]([Query_Id])
    ALTER TABLE [dbo].[Links] ADD CONSTRAINT [FK_dbo.Links_dbo.Queries_Query_Id] FOREIGN KEY ([Query_Id]) REFERENCES [dbo].[Queries] ([Id])
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'202012101209524_InitialModel', N'QueryAggregator.Migrations.Configuration',  0x1F8B0800000000000400ED59CB6EE33614DD17E83F085AB545C672120CD01AF60C5227298CE6D5C8197417D0D2B5430C45A92415D828FA655DF493FA0BBDD4CB1229397232098AA2F0C616EF9BE7BEE4BFFFFC6BFC711D31E71184A4319FB88783A1EB000FE290F2D5C44DD5F2DDF7EEC70F5F7F353E0BA3B5F3A9A43BD674C8C9E5C47D502A19799E0C1E20227210D140C4325EAA4110471E0963EF6838FCC13B3CF40045B828CB71C6B729573482EC07FE9CC63C8044A5845DC62130593CC7133F93EA5C910864420298B8BFA4203627AB95801551B118DC689BA442A3C1754E182568920F6CE93A84F3581185068FEE24F84AC47CE527F880B0F92601A45B1226A17064B425EFEBD3F048FBE46D194B51412A551CED29F0F0B8089267B23F2BD46E15440CE319865B6DB4D759288B28BA8EA96934654253D9619EC60206A7484BF9203B3B700C92830A1E8822FD3970A62953A98009875409C20E9C9B74C168F0336CE6F167E0139E3256B7132DC5B3C6037C7423E20484DADCC2B2B07E16BA8ED7E4F34CC68AADC693BB36E3EAF8C875AE50395930A860500B838FFEC04FC0411005E10D510A04D732200BA4A5DDD0954506018749542A2D7F5D92F505F0957A98B847EFDFBBCE395D43583E290CB9E3143310999448A1C55043F91579A4ABCC6EC38C0BCA3F4BD7B905969DCA079AE4B991DFE07D717E2EE2E83666A5DDF9E37B3F4E854EA9796C9FCD8958816A1A32F6B620DB093D2DE2B9C8D3BCFF03AF5BD79D603B00875FBF08E00CA573AA18BCBDDA539081A0495E205FACBC0F944FA48C039A5D543DD18B3C6A1A7BC643674752E5E656A98826236269821845BD137738181C5AFEB78B2C73B12632CFB0A6C4EF4C176BCED8E98A0D5961BE81A8FBB9CD387D0C6BD592C5D8688B449645644D1FB4781F544D30052C42DB8837E362C5A0C95F94308B3B0F81C15C73B96941550A6B142D95D2AC0FBBEFB832B5E6A5D74F4479A73511858166F169BAD482E1EA26B73395970F55E5F0E5754C5FE34B9224984EB569AC78E2F8F928367DE7EF3F9A44B90C2F902D134A656DA509D14656609CA26AB4F49C0AA94E89220BA2137A1A461659076E3B30552A6D42D3BEB2126B25BDFEDE9A27F5E1B400B4216D1BD473F433C22A9FB90C06785AF8B2E19830225ADACD346669C4BB5AD62EEEC6E45217D338B0E58D3DC30D336A9E153603C9E62DF4BAA3AEBC7CDE0D654563FF0B6A677B9DFBC91A7C9D3D7BD09FBFE8D57509C5A3FE321A8DB72EA971F0F61869D6423B99AB2ABF47BE962C7DEE5C17F3B6746AF6053B2CBD60924B6A038B0E4BA5773F938A3EF34C93F63606CB6F48B3E96926F5B057CD627D1C357B9D0D01ABE599241500ABD667B4B871D16E9E7E0B61F59F9CC475D0F7471AEADEE36F1048D140130CFCDFD8945184FC96E09270BA04A9F285C4C5FDFFC8787FF1EF7997E04919B23E2F14DE7CA5A23AA44F2E4D7B6E162DEB3B7F24227820C25EE077CADE6F29FE6F44AFB6839651FB2622EB6F5FB657BE4C54CBAED829D0DE073B10726F04D25A86663C84F5C4FD3D631A39B35FEF4BBE03E75A600D183943E78FDDBA5F61177DF1FA992F57FB2D9CFAA52F2C4168501186255A2A8145DA9A016E30EB029A10D6B0D8EE507D524147AF92679E9C42025C63BCEE541F3DBB3A7125D448C9A75CDF731DB7B79FA7B7EC4DF78E9DF7AE891B2E62BCD61C891D2B6BEB02DEB97FB7096E5F645F7935B7B671EBCD420BC0CD71EF55966F7BE240B4D4FE1D419C4ABADA8AD0431487A081938A66C697710958C3A292C4286497A04888203A118A2E49A0F0380029B3CEF789B01449CEA20584337E9DAA2455E832440BD6089F86FD2EFDD91B86A6CDE3EBAC16CB2FE1029A49D105B8E63FA6948595DDE72DEDB84384CEA7A203EABB54BA13AE3695A4AB98F7145484AF2A0373881286C2E435F7C9233CC7B63B0917B89D049B7270EC16F2F44534C33E3EA5642548240B195B7EFD8F9FA7FFF2FBF00F7ABF29F3241C0000 , N'6.4.4')
END

